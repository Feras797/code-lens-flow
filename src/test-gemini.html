<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini API Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 50px auto; 
            padding: 20px;
            background: #f5f5f5;
        }
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        input[type="text"] { 
            width: 100%; 
            padding: 10px; 
            margin: 10px 0; 
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button { 
            background: #4285f4; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover { background: #3367d6; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .result { 
            margin: 20px 0; 
            padding: 15px; 
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .loading { color: #6c757d; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Gemini API Test</h1>
        <p>This test will help debug Gemini API connectivity issues.</p>
        
        <div>
            <label for="apiKey">API Key:</label>
            <input type="text" id="apiKey" placeholder="Enter your VITE_GEMINI_API_KEY">
        </div>
        
        <div>
            <button onclick="testListModels()">1. Test List Models</button>
            <button onclick="testBasicGeneration()">2. Test Basic Generation</button>
            <button onclick="testAllEndpoints()">3. Test All Endpoint Formats</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        let resultsDiv = document.getElementById('results');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            resultsDiv.appendChild(div);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
        }

        function getApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (!key) {
                log('Please enter your API key!', 'error');
                return null;
            }
            return key;
        }

        async function testListModels() {
            const apiKey = getApiKey();
            if (!apiKey) return;

            log('üîÑ Testing model listing...', 'loading');
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1/models?key=${apiKey}`);
                
                log(`Response Status: ${response.status}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    const models = data.models?.map(m => m.name) || [];
                    log(`‚úÖ Found ${models.length} models:`, 'success');
                    models.forEach(model => log(`  - ${model}`, 'info'));
                } else {
                    const errorText = await response.text();
                    log(`‚ùå Error: ${response.status} - ${errorText}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Exception: ${error.message}`, 'error');
            }
        }

        async function testBasicGeneration() {
            const apiKey = getApiKey();
            if (!apiKey) return;

            log('üîÑ Testing basic text generation...', 'loading');
            
            const endpoints = [
                'https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent',
                'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent',
                'https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent'
            ];

            for (let i = 0; i < endpoints.length; i++) {
                const endpoint = endpoints[i];
                log(`\nüß™ Testing endpoint ${i + 1}: ${endpoint}`, 'info');
                
                try {
                    const response = await fetch(`${endpoint}?key=${apiKey}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: 'Say hello in 5 words'
                                }]
                            }]
                        })
                    });

                    log(`Response Status: ${response.status}`, response.ok ? 'success' : 'error');
                    
                    if (response.ok) {
                        const data = await response.json();
                        const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                        log(`‚úÖ SUCCESS! Generated text: "${text}"`, 'success');
                        log(`Working endpoint: ${endpoint}`, 'success');
                        break; // Stop testing once we find a working endpoint
                    } else {
                        const errorText = await response.text();
                        log(`‚ùå Failed: ${response.status} - ${errorText}`, 'error');
                    }
                } catch (error) {
                    log(`‚ùå Exception: ${error.message}`, 'error');
                }
            }
        }

        async function testAllEndpoints() {
            const apiKey = getApiKey();
            if (!apiKey) return;

            log('üîÑ Testing all possible endpoint combinations...', 'loading');
            
            const baseUrls = [
                'https://generativelanguage.googleapis.com/v1',
                'https://generativelanguage.googleapis.com/v1beta'
            ];
            
            const models = [
                'gemini-1.5-flash',
                'gemini-1.5-pro',
                'gemini-pro',
                'models/gemini-1.5-flash',
                'models/gemini-1.5-pro',
                'models/gemini-pro'
            ];

            for (const baseUrl of baseUrls) {
                for (const model of models) {
                    const endpoint = `${baseUrl}/models/${model}:generateContent`;
                    log(`\nüß™ Testing: ${endpoint}`, 'info');
                    
                    try {
                        const response = await fetch(`${endpoint}?key=${apiKey}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [{
                                        text: 'Hello world'
                                    }]
                                }]
                            })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                            log(`‚úÖ SUCCESS! Working endpoint found!`, 'success');
                            log(`Endpoint: ${endpoint}`, 'success');
                            log(`Response: "${text}"`, 'success');
                            return; // Stop when we find the first working endpoint
                        } else {
                            log(`‚ùå ${response.status}`, 'error');
                        }
                    } catch (error) {
                        log(`‚ùå Exception: ${error.message}`, 'error');
                    }
                    
                    // Small delay to avoid overwhelming the API
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
            }
            
            log('‚ùå No working endpoints found!', 'error');
        }
    </script>
</body>
</html>